cls;
[string]$GroupName = $args[0];

if($GroupName.Length -gt 63 -or $GroupName.Length -le 0 -or $GroupName -match "^\s|[#,+\<>@<`|`"]|\s$|^\d+$")
{
    throw [System.ArgumentException]::new("hahahaha")
}
else
{
    # Check for admin rights
    if (-NOT ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole(`
        [Security.Principal.WindowsBuiltInRole] "Administrator"))
    {
        throw [System.UnauthorizedAccessException]::new("Vous n'avez pas les droits d'administration!")
        Break
    } 
    else {
        
        $date = Get-Date

        if (!(Get-LocalGroup | where {$_.Name -eq $GroupName})) {

            New-LocalGroup -Name $GroupName

            if(Get-LocalGroup | where {$_.Name -eq $GroupName}) {
                Write-Output "[$date] [OK] $GroupName a été crée avec succès" >> Create-Group.log
                Write-Host "[$date] [OK] $GroupName a été crée avec succès"
            }
            else {
                Write-Output "[$date] [NOT OK] $GroupName n'a pas été crée" >> Create-Group.log
                Write-Host "[$date] [NOT OK] $GroupName n'a pas été crée"
            }
        }
        else {
            Write-Output "[$date] [INFO] le groupe $GroupName existe déjà" >> Create-Group.log
            Write-Host "[$date] [INFO] le groupe $GroupName existe déjà"
        }
    }
}